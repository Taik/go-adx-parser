machine:
  pre:
    - bash < <(curl -s -S -L https://raw.githubusercontent.com/moovweb/gvm/master/binscripts/gvm-installer)
    - source /home/ubuntu/.gvm/scripts/gvm
  post:
    - gvm install go1.4.2 --name=stable --binary --with-protobuf --with-build-tools
    - gvm use stable --default
    - go get github.com/mitchellh/gox
    - gox -build-toolchain -os="linux darwin" -arch="amd64" -cgo

dependencies:
  pre:
    - go get github.com/tools/godep
  override:
    - godep restore
    - gvm linkthis github.com/taik/go-adx-parser

test:
  override:
    - godep go test -v ./...
  post:
    - gox -os="linux darwin" -arch="amd64"
    - mv go-adx-parser_* $CIRCLE_ARTIFACTS/
