machine:
  pre:
    - bash < <(curl -s -S -L https://raw.githubusercontent.com/moovweb/gvm/master/binscripts/gvm-installer)
    - source /home/ubuntu/.gvm/scripts/gvm
  post:
    - gvm install go1.4.2 --name=stable --binary --with-protobuf --with-build-tools
    - gvm use stable --default
    - go get github.com/laher/goxc && goxc -bc="linux,darwin" -arch="amd64" -t

dependencies:
  pre:
    - go get github.com/tools/godep
  override:
    - godep restore
    - gvm linkthis github.com/taik/go-adx-parser

test:
  override:
    - godep go test -v ./...
  post:
    - goxc -d=$CIRCLE_ARTIFACTS -bc="linux,darwin" -arch="amd64":
        pwd: /home/ubuntu/.gvm/pkgsets/stable/global/src/github.com/taik/go-adx-parser/
